var k=(l,s,d)=>new Promise((a,f)=>{var p=n=>{try{c(d.next(n))}catch(_){f(_)}},g=n=>{try{c(d.throw(n))}catch(_){f(_)}},c=n=>n.done?a(n.value):Promise.resolve(n.value).then(p,g);c((d=d.apply(l,s)).next())});import{_ as V,r as m,o as z,D as N,h as o,L as F,i as b,d as U,e,w as t,B as K,q as B,j as v,v as S,F as E,M as j,m as q}from"./index-f770ad8c.js";import{u as O}from"./usePagination-965b137c.js";import $ from"./EditDialog-a826a7fd.js";import"./tinymce-87fd2522.js";import"./echarts-c0f2d21b.js";import"./useModal-5ff77b06.js";import"./useForm-c124bf97.js";const A={name:"systemUser",components:{EditDialog:$},setup(){const{loading:l,pagination:s,resetPagination:d}=O(),a=m(!1),f=m([]),p=m(["0"]),g=m([{title:"ID",dataIndex:"id"},{title:"头像",key:"avatar"},{title:"登录帐号",dataIndex:"userName"},{title:"姓名",dataIndex:"name"},{title:"所属角色",dataIndex:"roleName"},{title:"加入时间",dataIndex:"date"},{title:"操作",key:"action",fixed:"right",width:160}]),c=m([]),n=m();z(()=>{_(),u()});function _(){return k(this,null,function*(){a.value=!0;const{code:i,data:r}=yield N.system.getUserRoleList().catch(()=>{a.value=!1});a.value=!1,i===200&&(f.value=[{name:"全部",key:"0"},...r.rows])})}function u(){return k(this,null,function*(){l.value=!0;const{pageSize:i,current:r}=s,{code:D,data:L}=yield N.system.getUserPageList({pageSize:i,page:r}).catch(()=>{l.value=!1});if(l.value=!1,D===200){const{rows:y,total:R}=L;c.value=y,s.total=R}})}function C(i){i.length&&(p.value=i,d(),u())}function w({id:i}){j.confirm({title:"删除提示",content:"确认删除？",onOk:()=>k(this,null,function*(){l.value=!0;const{code:r}=yield N.common.deleteData({id:i}).catch(()=>{l.value=!1});r===200?(q.success("删除成功"),yield u()):l.value=!1})})}function h({current:i,pageSize:r}){s.current=i,s.pageSize=r,u()}return{roleLoading:a,selectedKeys:p,roleList:f,userList:c,loading:l,pagination:s,columns:g,editDialogRef:n,handleRole:C,handleDelete:w,onTableChange:h}}};function G(l,s,d,a,f,p){const g=o("a-tree"),c=o("a-card"),n=o("a-col"),_=o("icon-plus-outlined"),u=o("a-button"),C=o("a-input"),w=o("a-form-item"),h=o("a-row"),i=o("a-form"),r=o("x-search-bar"),D=o("x-action-bar"),L=o("a-avatar"),y=o("x-action-button"),R=o("a-table"),M=o("edit-dialog"),T=F("loading");return b(),U(E,null,[e(h,{type:"flex",gutter:16,style:{position:"absolute",left:0,right:0,top:0,bottom:0}},{default:t(()=>[e(n,{flex:"0 0 240px"},{default:t(()=>[K((b(),B(c,{bordered:!1,type:"flex"},{default:t(()=>[e(g,{"selected-keys":a.selectedKeys,"tree-data":a.roleList,"field-names":{title:"name",children:"children",key:"key"},"block-node":"",onSelect:a.handleRole},null,8,["selected-keys","tree-data","onSelect"])]),_:1})),[[T,a.roleLoading]])]),_:1}),e(n,{flex:"1"},{default:t(()=>[e(c,{bordered:!1,type:"flex"},{default:t(()=>[e(D,{class:"mb-8-2"},{extra:t(()=>[e(r,{"body-style":{padding:0}},{default:t(()=>[e(i,{layout:"inline"},{default:t(()=>[e(h,{gutter:12,type:"flex"},{default:t(()=>[e(n,null,{default:t(()=>[e(w,null,{default:t(()=>[e(C)]),_:1})]),_:1}),e(n,null,{default:t(()=>[e(u,{type:"primary",ghost:""},{default:t(()=>[v("搜索 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(u,{type:"primary",onClick:s[0]||(s[0]=I=>l.$refs.editDialogRef.handleCreate())},{icon:t(()=>[e(_)]),default:t(()=>[v(" 新建用户 ")]),_:1})]),_:1}),e(R,{columns:a.columns,"data-source":a.userList,loading:a.loading,pagination:a.pagination,onChange:a.onTableChange},{bodyCell:t(({column:I,record:x})=>[I.key==="avatar"?(b(),B(L,{key:0,src:x.avatar},null,8,["src"])):S("",!0),I.key==="action"?(b(),U(E,{key:1},[e(y,{onClick:P=>l.$refs.editDialogRef.handlePreview(x)},{default:t(()=>[v("查看")]),_:2},1032,["onClick"]),e(y,{onClick:P=>l.$refs.editDialogRef.handleEdit(x)},{default:t(()=>[v("编辑")]),_:2},1032,["onClick"]),e(y,{onClick:P=>a.handleDelete(x)},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])],64)):S("",!0)]),_:1},8,["columns","data-source","loading","pagination","onChange"])]),_:1})]),_:1})]),_:1}),e(M,{ref:"editDialogRef"},null,512)],64)}const te=V(A,[["render",G]]);export{te as default};
